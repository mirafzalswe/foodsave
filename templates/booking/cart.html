{% extends 'base.html' %}
{% load static %}

{% block title %}Корзина - FoodSave{% endblock %}

{% block extra_css %}
<style>
/* ===== FRIENDLY SMART CART DESIGN SYSTEM ===== */
:root {
    /* Основная палитра FoodSave - экологичная и дружелюбная */
    --primary: #059669;            /* Зеленый - природа и экология */
    --primary-light: #10b981;      /* Светлый зеленый */
    --primary-dark: #047857;       /* Темный зеленый */
    
    /* Акцентные цвета - экологические */
    --success: #16a34a;            /* Изумрудный - успех и спасение природы */
    --success-light: #22c55e;      /* Светлый изумрудный */
    --warning: #f59e0b;            /* Янтарный - внимание к сроку годности */
    --danger: #dc2626;             /* Красный - срочно нужно продать */
    --danger-light: #ef4444;       /* Светлый красный */
    
    /* Нейтральные - спокойные и читаемые */
    --gray-50: #f9fafb;            /* Почти белый фон */
    --gray-100: #f3f4f6;           /* Очень светлый серый */
    --gray-200: #e5e7eb;           /* Светлый серый */
    --gray-300: #d1d5db;           /* Средне-светлый серый */
    --gray-400: #9ca3af;           /* Средний серый */
    --gray-500: #6b7280;           /* Средне-темный серый */
    --gray-600: #4b5563;           /* Темный серый */
    --gray-700: #374151;           /* Очень темный серый */
    --gray-800: #1f2937;           /* Почти черный */
    
    /* Акценты - эмоциональные */
    --accent-warm: #fbbf24;        /* Теплый желтый */
    --accent-cool: #60a5fa;        /* Прохладный синий */
    --accent-green: #84cc16;       /* Свежий зеленый */
    
    /* Тени - мягкие и дружелюбные */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    
    /* Анимации - плавные и естественные */
    --transition-fast: 0.15s ease-out;
    --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ===== БАЗОВЫЕ СТИЛИ ===== */
body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
    color: var(--gray-800);
    line-height: 1.6;
}

/* ===== SMART CART HERO 2.0 ===== */
.cart-hero {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    color: white;
    padding: 3rem 0;
    margin-bottom: 2rem;
    border-radius: 0 0 2rem 2rem;
    box-shadow: var(--shadow-xl);
    position: relative;
    overflow: hidden;
}

.cart-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
    pointer-events: none;
}

.cart-hero::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 20% 80%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(239, 68, 68, 0.1) 0%, transparent 50%);
    pointer-events: none;
    animation: backgroundShift 8s ease-in-out infinite;
}

.cart-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 10% 90%, rgba(16, 185, 129, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 90% 10%, rgba(59, 130, 246, 0.05) 0%, transparent 40%);
    pointer-events: none;
    animation: backgroundShiftSecondary 12s ease-in-out infinite reverse;
}

.cart-hero::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 20% 80%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(239, 68, 68, 0.1) 0%, transparent 50%);
    pointer-events: none;
    animation: backgroundShift 8s ease-in-out infinite;
}

.cart-hero::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 20% 80%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(239, 68, 68, 0.1) 0%, transparent 50%);
    pointer-events: none;
    animation: backgroundShift 8s ease-in-out infinite;
}

@keyframes backgroundShiftSecondary {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.8; }
}

@keyframes backgroundShift {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Главный заголовок */
.hero-main {
    text-align: center;
    margin-bottom: 2rem;
    position: relative;
    z-index: 1;
    animation: fadeInUp 1s ease-out;
}

.hero-main::before {
    content: '';
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: heroLineGlow 2s ease-in-out infinite;
}

@keyframes heroLineGlow {
    0%, 100% { opacity: 0.3; width: 100px; }
    50% { opacity: 1; width: 150px; }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.hero-title {
    font-size: 3rem;
    font-weight: 800;
    margin: 0 0 1rem 0;
    text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    letter-spacing: -0.03em;
    color: #ffffff;
    position: relative;
}

.hero-title::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, #fbbf24, #ef4444);
    border-radius: 2px;
    animation: titleUnderline 2s ease-in-out infinite;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
}

.hero-title::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -20px;
    width: 4px;
    height: 4px;
    background: #fbbf24;
    border-radius: 50%;
    transform: translateY(-50%) scale(0);
    animation: titleDot 2s ease-in-out infinite 0.5s;
    box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);
}

.hero-title::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, #fbbf24, #ef4444);
    border-radius: 2px;
    animation: titleUnderline 2s ease-in-out infinite;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
}

.hero-title::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, #fbbf24, #ef4444);
    border-radius: 2px;
    animation: titleUnderline 2s ease-in-out infinite;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
}

@keyframes titleDot {
    0%, 100% { transform: translateY(-50%) scale(0); }
    50% { transform: translateY(-50%) scale(1); }
}

@keyframes titleUnderline {
    0%, 100% { width: 60px; opacity: 1; }
    50% { width: 100px; opacity: 0.7; }
}

.hero-subtitle {
    font-size: 1.25rem;
    margin: 0;
    opacity: 0.9;
    font-weight: 500;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    animation: subtitleGlow 3s ease-in-out infinite;
    position: relative;
}

.hero-subtitle::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.5), transparent);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.hero-subtitle:hover::after {
    transform: scaleX(1);
}

@keyframes subtitleGlow {
    0%, 100% { text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    50% { text-shadow: 0 2px 8px rgba(251, 191, 36, 0.3); }
}

/* Интерактивная статистика */
.cart-stats-interactive {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
    position: relative;
    z-index: 1;
}

.stat-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 1.5rem;
    padding: 1.5rem;
    min-width: 140px;
    text-align: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    opacity: 0;
    transform: translateY(20px);
    position: relative;
    z-index: 1;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
    border-radius: 1.5rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.stat-card:hover::before {
    opacity: 1;
}

.stat-card:hover {
    transform: translateY(-8px) scale(1.05);
    background: rgba(255, 255, 255, 0.25);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    border-color: rgba(255, 255, 255, 0.4);
    z-index: 10;
}

.stat-card:hover .stat-icon {
    transform: scale(1.1) rotate(5deg);
    color: #fbbf24;
    filter: drop-shadow(0 4px 8px rgba(251, 191, 36, 0.3));
}

.stat-card:hover .stat-value {
    color: #fbbf24;
    text-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
    transform: scale(1.05);
}

.stat-card:hover .stat-label {
    color: #fbbf24;
    transform: translateY(-2px);
}

.stat-card:hover .stat-icon {
    transform: scale(1.1) rotate(5deg);
    color: #fbbf24;
}

.stat-card:hover .stat-value {
    color: #fbbf24;
    text-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
}

.stat-card.primary-stat {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.15) 100%);
    border: 2px solid rgba(255, 255, 255, 0.4);
    transform: scale(1.05);
    position: relative;
    overflow: hidden;
}

.stat-card.primary-stat::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transform: rotate(45deg);
    animation: primaryStatShine 3s ease-in-out infinite;
}

.stat-card.primary-stat::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, transparent 0%, rgba(251, 191, 36, 0.1) 50%, transparent 100%);
    border-radius: 1.5rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.stat-card.primary-stat .stat-icon {
    animation: primaryStatIconGlow 2s ease-in-out infinite;
}

@keyframes primaryStatIconGlow {
    0%, 100% { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1)); }
    50% { filter: drop-shadow(0 4px 8px rgba(251, 191, 36, 0.4)); }
}

.stat-card.primary-stat .stat-icon {
    animation: primaryStatIconGlow 2s ease-in-out infinite;
}

@keyframes primaryStatIconGlow {
    0%, 100% { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1)); }
    50% { filter: drop-shadow(0 4px 8px rgba(251, 191, 36, 0.4)); }
}

.stat-card.primary-stat .stat-value {
    animation: primaryStatValueGlow 2s ease-in-out infinite 0.5s;
}

@keyframes primaryStatValueGlow {
    0%, 100% { text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    50% { text-shadow: 0 2px 8px rgba(251, 191, 36, 0.3); }
}

.stat-card.primary-stat:hover::after {
    opacity: 1;
}

@keyframes primaryStatShine {
    0% { transform: rotate(45deg) translateX(-100%); }
    100% { transform: rotate(45deg) translateX(100%); }
}

.stat-card.primary-stat:hover {
    transform: translateY(-8px) scale(1.1);
}

.stat-icon {
    font-size: 2rem;
    margin-bottom: 0.75rem;
    opacity: 0.9;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.stat-icon:hover {
    filter: drop-shadow(0 4px 8px rgba(251, 191, 36, 0.4));
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.stat-value::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.5), transparent);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.stat-card:hover .stat-value::after {
    transform: scaleX(1);
}

.stat-label {
    font-size: 0.875rem;
    opacity: 0.8;
    font-weight: 500;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.stat-label::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -10px;
    width: 4px;
    height: 4px;
    background: rgba(251, 191, 36, 0.5);
    border-radius: 50%;
    transform: translateY(-50%) scale(0);
    transition: transform 0.3s ease;
}

.stat-card:hover .stat-label::before {
    transform: translateY(-50%) scale(1);
}

/* Прогресс-бар экономии */
.savings-progress-container {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 1.5rem;
    padding: 1.5rem;
    margin: 0 auto;
    max-width: 500px;
    position: relative;
    z-index: 1;
    animation: slideInUp 0.8s ease-out 0.5s both;
    overflow: hidden;
}

.savings-progress-container::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.05), transparent);
    animation: progressContainerRotate 10s linear infinite;
    z-index: -1;
}

@keyframes progressContainerRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.progress-text {
    font-weight: 500;
    font-size: 0.875rem;
    transition: all 0.3s ease;
}

.progress-text:hover {
    color: #fbbf24;
    transform: translateX(5px);
}

.progress-percentage {
    font-weight: 700;
    font-size: 1.125rem;
    color: #fbbf24;
    animation: percentagePulse 2s ease-in-out infinite;
    position: relative;
}

.progress-percentage::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -15px;
    width: 8px;
    height: 8px;
    background: #fbbf24;
    border-radius: 50%;
    transform: translateY(-50%) scale(0);
    animation: percentageDot 2s ease-in-out infinite 0.5s;
    box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);
}

.progress-percentage::after {
    content: '';
    position: absolute;
    top: 50%;
    right: -15px;
    width: 6px;
    height: 6px;
    background: #ef4444;
    border-radius: 50%;
    transform: translateY(-50%) scale(0);
    animation: percentageDotSecondary 2s ease-in-out infinite 1s;
    box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
}

.progress-percentage::after {
    content: '';
    position: absolute;
    top: 50%;
    right: -15px;
    width: 6px;
    height: 6px;
    background: #ef4444;
    border-radius: 50%;
    transform: translateY(-50%) scale(0);
    animation: percentageDotSecondary 2s ease-in-out infinite 1s;
    box-shadow: 0 0 6px rgba(239, 68, 68, 0.6);
}

@keyframes percentageDotSecondary {
    0%, 100% { transform: translateY(-50%) scale(0); }
    50% { transform: translateY(-50%) scale(1); }
}

.progress-percentage {
    font-weight: 700;
    font-size: 1.125rem;
    color: #fbbf24;
    animation: percentagePulse 2s ease-in-out infinite;
    position: relative;
}

@keyframes percentageDot {
    0%, 100% { transform: translateY(-50%) scale(0); }
    50% { transform: translateY(-50%) scale(1); }
}

@keyframes percentagePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.progress-bar-hero {
    width: 100%;
    height: 12px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 0.75rem;
    position: relative;
}

.progress-bar-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
    animation: progressBarGlow 2s ease-in-out infinite;
}

.progress-bar-hero::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(251, 191, 36, 0.05) 50%, transparent 100%);
    animation: progressBarGlowSecondary 3s ease-in-out infinite 1s;
}

.progress-bar-hero {
    width: 100%;
    height: 12px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 0.75rem;
    position: relative;
}

.progress-bar-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
    animation: progressBarGlow 2s ease-in-out infinite;
}

.progress-bar-hero {
    width: 100%;
    height: 12px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 0.75rem;
    position: relative;
}

.progress-bar-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
    animation: progressBarGlow 2s ease-in-out infinite;
}

@keyframes progressBarGlowSecondary {
    0%, 100% { opacity: 0.1; }
    50% { opacity: 0.3; }
}

@keyframes progressBarGlow {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.8; }
}

.progress-fill-hero {
    height: 100%;
    background: linear-gradient(90deg, #10b981 0%, #fbbf24 50%, #ef4444 100%);
    border-radius: 6px;
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
    animation: progressFillGlow 2s ease-in-out infinite;
}

@keyframes progressFillGlow {
    0%, 100% { box-shadow: 0 0 10px rgba(16, 185, 129, 0.3); }
    50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); }
}

.progress-fill-hero::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: progressShine 2s ease-in-out infinite;
}

@keyframes progressShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.progress-target {
    text-align: center;
    font-size: 0.875rem;
    opacity: 0.8;
    transition: all 0.3s ease;
}

.progress-target:hover {
    opacity: 1;
    transform: scale(1.05);
}

.progress-target strong {
    color: #fbbf24;
    font-weight: 800;
    position: relative;
}

.progress-target strong::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #fbbf24, #ef4444);
    border-radius: 1px;
    transform: scaleX(0);
    transition: transform 0.3s ease;
    box-shadow: 0 2px 4px rgba(251, 191, 36, 0.3);
}

.progress-target strong::before {
    content: '';
    position: absolute;
    top: -2px;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.3), transparent);
    transform: scaleX(0);
    transition: transform 0.3s ease 0.1s;
}

.progress-target:hover strong::before {
    transform: scaleX(1);
}

.progress-target {
    text-align: center;
    font-size: 0.875rem;
    opacity: 0.8;
    transition: all 0.3s ease;
}

.progress-target:hover strong::after {
    transform: scaleX(1);
}

/* Эмоциональные бейджи */
.hero-badges {
    text-align: center;
    margin-top: 1.5rem;
    position: relative;
    z-index: 1;
    animation: fadeIn 1s ease-out 1s both;
}

.hero-badges::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, rgba(251, 191, 36, 0.1) 0%, transparent 70%);
    border-radius: 50%;
    animation: badgeBackgroundPulse 4s ease-in-out infinite;
    z-index: -1;
}

@keyframes badgeBackgroundPulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.6; }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: scale(0.8);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.badge-emotion {
    font-size: 3rem;
    animation: emotionFloat 3s ease-in-out infinite;
    display: inline-block;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.badge-emotion::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(251, 191, 36, 0.2) 0%, transparent 70%);
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.badge-emotion::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 150%;
    height: 150%;
    background: conic-gradient(from 0deg, transparent, rgba(251, 191, 36, 0.1), transparent);
    border-radius: 50%;
    animation: badgeRotate 4s linear infinite;
    z-index: -2;
}

.badge-emotion {
    font-size: 3rem;
    animation: emotionFloat 3s ease-in-out infinite;
    display: inline-block;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.badge-emotion::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(251, 191, 36, 0.2) 0%, transparent 70%);
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

@keyframes badgeRotate {
    from { transform: translate(-50%, -50%) rotate(0deg); }
    to { transform: translate(-50%, -50%) rotate(360deg); }
}

.badge-emotion:hover::before {
    opacity: 1;
}

.badge-emotion:hover {
    transform: scale(1.2) rotate(10deg);
    filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3));
}

@keyframes emotionFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(5deg); }
}

/* ===== УМНАЯ НАВИГАЦИЯ ===== */
.smart-navigation {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 1rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-100);
}

.breadcrumb-friendly {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--gray-600);
}

.breadcrumb-friendly a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition-fast);
}

.breadcrumb-friendly a:hover {
    color: var(--primary-dark);
}

.breadcrumb-friendly .separator {
    color: var(--gray-400);
}

/* ===== БЫСТРЫЕ ДЕЙСТВИЯ ===== */
.quick-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.quick-action-btn {
    background: white;
    border: 2px solid var(--gray-200);
    color: var(--gray-700);
    padding: 0.875rem 1.5rem;
    border-radius: 1rem;
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition-normal);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.quick-action-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(79, 70, 229, 0.1), transparent);
    transition: var(--transition-normal);
}

.quick-action-btn:hover::before {
    left: 100%;
}

.quick-action-btn:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    text-decoration: none;
}

.quick-action-btn.primary {
    background: linear-gradient(135deg, var(--success) 0%, var(--success-light) 100%);
    border-color: var(--success);
    color: white;
    box-shadow: var(--shadow-md);
}

.quick-action-btn.primary:hover {
    background: linear-gradient(135deg, var(--success-light) 0%, var(--success) 100%);
    border-color: var(--success-light);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

/* ===== СОСТОЯНИЕ ПУСТОЙ КОРЗИНЫ ===== */
.empty-cart-friendly {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 1.5rem;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-100);
    animation: fadeInUp 0.6s ease-out;
}

.empty-cart-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    animation: float 3s ease-in-out infinite;
}

.empty-cart-friendly h3 {
    color: var(--gray-700);
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.empty-cart-friendly p {
    color: var(--gray-600);
    margin-bottom: 2rem;
    font-size: 1.125rem;
}

.empty-cart-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

/* ===== УМНЫЕ КАРТОЧКИ ТОВАРОВ ===== */
.cart-item-friendly {
    background: white;
    border-radius: 1.25rem;
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--gray-100);
    transition: var(--transition-normal);
    animation: slideInUp 0.4s ease-out;
    position: relative;
    overflow: hidden;
}

.cart-item-friendly::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%);
    opacity: 0;
    transition: var(--transition-normal);
}

.cart-item-friendly:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
    border-color: var(--gray-200);
}

.cart-item-friendly:hover::before {
    opacity: 1;
}

.cart-item-content {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.cart-item-image {
    width: 80px;
    height: 80px;
    border-radius: 1rem;
    object-fit: cover;
    box-shadow: var(--shadow-sm);
    transition: var(--transition-normal);
}

.cart-item-friendly:hover .cart-item-image {
    transform: scale(1.05);
}

.cart-item-details {
    flex: 1;
}

.cart-item-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
}

.cart-item-vendor {
    color: var(--gray-600);
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.cart-item-price {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--success);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.price-savings {
    font-size: 0.75rem;
    color: var(--success);
    background: var(--gray-50);
    padding: 0.25rem 0.5rem;
    border-radius: 0.5rem;
    font-weight: 500;
}

/* ===== ДРУЖЕЛЮБНЫЕ КОНТРОЛЫ КОЛИЧЕСТВА ===== */
.quantity-controls-friendly {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--gray-50);
    border-radius: 1rem;
    padding: 0.25rem;
    border: 1px solid var(--gray-200);
}

.quantity-btn-friendly {
    width: 2.5rem;
    height: 2.5rem;
    border: none;
    background: white;
    border-radius: 0.75rem;
    color: var(--gray-700);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.quantity-btn-friendly::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: var(--primary);
    border-radius: 50%;
    transition: var(--transition-fast);
    transform: translate(-50%, -50%);
}

.quantity-btn-friendly:hover::before {
    width: 100%;
    height: 100%;
}

.quantity-btn-friendly:hover {
    color: white;
    transform: scale(1.05);
}

.quantity-btn-friendly:active {
    transform: scale(0.95);
}

.quantity-input-friendly {
    width: 3.5rem;
    text-align: center;
    border: none;
    background: transparent;
    font-weight: 600;
    color: var(--gray-800);
    font-size: 1rem;
    border-radius: 0.5rem;
    padding: 0.5rem;
}

.quantity-input-friendly:focus {
    outline: none;
    background: white;
    box-shadow: var(--shadow-sm);
}

/* ===== ДРУЖЕЛЮБНАЯ КНОПКА УДАЛЕНИЯ ===== */
.remove-btn-friendly {
    background: var(--gray-100);
    color: var(--gray-600);
    border: none;
    border-radius: 1rem;
    padding: 0.75rem;
    cursor: pointer;
    transition: var(--transition-fast);
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.remove-btn-friendly::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(239, 68, 68, 0.1), transparent);
    transition: var(--transition-normal);
}

.remove-btn-friendly:hover::before {
    left: 100%;
}

.remove-btn-friendly:hover {
    background: var(--danger-light);
    color: white;
    transform: scale(1.05);
    box-shadow: var(--shadow-md);
}

.remove-btn-friendly:active {
    transform: scale(0.95);
}

/* ===== УМНАЯ СВОДКА ЗАКАЗА ===== */
.smart-summary {
    background: white;
    border-radius: 1.5rem;
    padding: 2rem;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--gray-100);
    position: sticky;
    top: 2rem;
    animation: slideInRight 0.4s ease-out;
}

.summary-mood {
    text-align: center;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
    border-radius: 1rem;
    border: 1px solid var(--gray-200);
}

.mood-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    display: block;
}

.mood-text {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--gray-700);
}

.summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--gray-100);
}

.summary-row:last-child {
    border-bottom: none;
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--gray-800);
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 2px solid var(--gray-200);
}

.summary-label {
    color: var(--gray-600);
    font-weight: 500;
}

.summary-value {
    font-weight: 600;
    color: var(--gray-800);
}

.summary-total {
    color: var(--success) !important;
    font-size: 1.5rem !important;
}

.summary-savings {
    color: var(--success);
    font-size: 0.875rem;
    font-weight: 500;
    background: var(--gray-50);
    padding: 0.25rem 0.5rem;
    border-radius: 0.5rem;
    margin-left: 0.5rem;
}

/* ===== ДРУЖЕЛЮБНЫЕ КНОПКИ ===== */
.checkout-btn-friendly {
    width: 100%;
    background: linear-gradient(135deg, var(--success) 0%, var(--success-light) 100%);
    color: white;
    border: none;
    border-radius: 1rem;
    padding: 1rem 2rem;
    font-size: 1.125rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-normal);
    box-shadow: var(--shadow-md);
    margin-top: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    position: relative;
    overflow: hidden;
}

.checkout-btn-friendly::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: var(--transition-normal);
}

.checkout-btn-friendly:hover::before {
    left: 100%;
}

.checkout-btn-friendly:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
    background: linear-gradient(135deg, var(--success-light) 0%, var(--success) 100%);
}

.checkout-btn-friendly:active {
    transform: translateY(0);
}

.continue-shopping-btn-friendly {
    width: 100%;
    background: white;
    color: var(--primary);
    border: 2px solid var(--primary);
    border-radius: 1rem;
    padding: 1rem 2rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-normal);
    margin-top: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-decoration: none;
    position: relative;
    overflow: hidden;
}

.continue-shopping-btn-friendly::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(79, 70, 229, 0.1), transparent);
    transition: var(--transition-normal);
}

.continue-shopping-btn-friendly:hover::before {
    left: 100%;
}

.continue-shopping-btn-friendly:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    text-decoration: none;
}

/* ===== УМНЫЕ ПОДСКАЗКИ ===== */
.smart-tips {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 1rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-md);
    position: relative;
    overflow: hidden;
}

.smart-tips::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
    pointer-events: none;
}

.smart-tips-content {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.smart-tips-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.smart-tips-text {
    font-weight: 500;
    font-size: 0.875rem;
}

/* ===== ЗАГРУЗКА ===== */
.skeleton-friendly {
    background: linear-gradient(90deg, var(--gray-200) 25%, var(--gray-100) 50%, var(--gray-200) 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 0.5rem;
}

.skeleton-item-friendly {
    height: 120px;
    margin-bottom: 1rem;
}

/* ===== УВЕДОМЛЕНИЯ ===== */
.notification-friendly {
    position: fixed;
    top: 2rem;
    right: 2rem;
    background: white;
    border-radius: 1rem;
    padding: 1rem 1.5rem;
    box-shadow: var(--shadow-xl);
    border-left: 4px solid var(--success);
    z-index: 1000;
    animation: slideInRight 0.3s ease-out;
    max-width: 300px;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.notification-friendly.success {
    border-left-color: var(--success);
}

.notification-friendly.error {
    border-left-color: var(--danger);
}

.notification-friendly.info {
    border-left-color: var(--primary);
}

.notification-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
}

.notification-text {
    font-weight: 500;
    color: var(--gray-800);
}

/* ===== АНИМАЦИИ ===== */
@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

/* ===== КАТАЛОГ РЕКОМЕНДУЕМЫХ ТОВАРОВ ===== */
.recommendations-section {
    margin-top: 3rem;
    padding: 2rem 0;
    background: var(--gray-50);
    border-radius: 1.5rem;
}

.recommendations-header {
    text-align: center;
    margin-bottom: 2rem;
}

.recommendations-header h3 {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: 0.5rem;
}

.recommendations-header p {
    color: var(--gray-600);
    font-size: 1rem;
}

.recommendations-carousel-container {
    width: 100%;
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
    padding: 0 2rem;
}

/* Навигационные кнопки карусели */
.carousel-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 50%;
    background: white;
    color: var(--primary);
    font-size: 1.125rem;
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    transition: var(--transition-normal);
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid var(--gray-100);
}

.carousel-nav-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-50%) scale(1.1);
    border-color: var(--primary);
    box-shadow: var(--shadow-xl);
}

.carousel-nav-btn:active {
    transform: translateY(-50%) scale(0.95);
}

.carousel-prev {
    left: 0;
}

.carousel-next {
    right: 0;
}

.recommendations-carousel {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding: 1rem 0;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;
    align-items: stretch;
    justify-content: flex-start;
    min-height: 420px;
    max-width: 1200px;
    margin: 0 auto;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    will-change: scroll-position;
    transform: translateZ(0);
}

.recommendations-carousel::-webkit-scrollbar {
    display: none;
}

.recommendation-item {
    flex: 0 0 280px;
    background: white;
    border-radius: 1rem;
    padding: 1rem;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-100);
    transition: var(--transition-normal);
    scroll-snap-align: center;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 400px;
    margin: 0 0.5rem;
}

.recommendation-item:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.recommendation-badges {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem;
    display: flex;
    gap: 0.5rem;
    z-index: 2;
}

.badge-hot, .badge-discount {
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 0.5rem;
    color: white;
}

.badge-hot {
    background: linear-gradient(135deg, #ef4444, #dc2626);
}

.badge-discount {
    background: linear-gradient(135deg, #10b981, #059669);
}

.recommendation-image {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-radius: 0.75rem;
    margin-bottom: 1rem;
    flex-shrink: 0;
}

.recommendation-content {
    padding: 0.5rem 0;
    display: flex;
    flex-direction: column;
    flex: 1;
}

.recommendation-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
    line-height: 1.4;
    height: 2.8em;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.recommendation-vendor {
    font-size: 0.875rem;
    color: var(--gray-600);
    margin-bottom: 0.75rem;
    height: 1.2em;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}

.recommendation-price {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-shrink: 0;
}

.current-price {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--success);
}

.original-price {
    font-size: 0.875rem;
    color: var(--gray-500);
    text-decoration: line-through;
}

.recommendation-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: auto;
    flex-shrink: 0;
}

.add-to-cart-btn {
    flex: 1;
    background: linear-gradient(135deg, var(--success) 0%, var(--success-light) 100%);
    color: white;
    border: none;
    border-radius: 0.75rem;
    padding: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.add-to-cart-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.quick-view-btn {
    background: var(--gray-100);
    color: var(--gray-600);
    border: none;
    border-radius: 0.75rem;
    padding: 0.75rem;
    cursor: pointer;
    transition: var(--transition-fast);
}

.quick-view-btn:hover {
    background: var(--gray-200);
    color: var(--gray-800);
}

/* Прогресс бесплатной доставки */
.delivery-progress {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    margin-top: 2rem;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-100);
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.progress-text {
    font-weight: 500;
    color: var(--gray-700);
}

.progress-percentage {
    font-weight: 700;
    color: var(--success);
    font-size: 1.125rem;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: var(--gray-200);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--success) 0%, var(--success-light) 100%);
    border-radius: 4px;
    transition: width 0.3s ease;
}

/* ===== АДАПТИВНОСТЬ ===== */
@media (max-width: 768px) {
    .hero-title {
        font-size: 2.25rem;
    }
    
    .hero-subtitle {
        font-size: 1.125rem;
    }
    
    .cart-item-content {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .quick-actions {
        justify-content: center;
    }
    
    .smart-summary {
        position: static;
        margin-top: 2rem;
    }
    
    .cart-stats-interactive {
        flex-direction: column;
        gap: 1rem;
        align-items: center;
    }
    
    .stat-card {
        min-width: 200px;
        padding: 1.25rem;
    }
    
    .savings-progress-container {
        margin: 0 1rem;
        padding: 1.25rem;
    }
    
    .progress-info {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
    }
    
    .badge-emotion {
        font-size: 2.5rem;
    }
    
    .recommendation-item {
        flex: 0 0 240px;
        height: 380px;
    }
    
    .recommendations-header h3 {
        font-size: 1.5rem;
    }
    
    .recommendations-carousel {
        justify-content: flex-start;
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    .carousel-nav-btn {
        display: none;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Smart Cart Hero 2.0 -->
<div class="cart-hero">
    <div class="container">
        <!-- Главный заголовок с эмоциональным состоянием -->
        <div class="hero-main">
            <h1 class="hero-title">
                <i class="fas fa-shopping-bag me-3"></i>Ваша корзина
            </h1>
            <p class="hero-subtitle" id="heroSubtitle">Готовы к выгодной покупке? 💰</p>
        </div>
        
        <!-- Интерактивная статистика -->
        <div class="cart-stats-interactive">
            <div class="stat-card primary-stat">
                <div class="stat-icon">
                    <i class="fas fa-box"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="itemCount">0</div>
                    <div class="stat-label">товаров</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">15-30</div>
                    <div class="stat-label">минут</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-piggy-bank"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalSavings">0</div>
                    <div class="stat-label">сум экономии</div>
                </div>
            </div>
        </div>
        
        <!-- Прогресс-бар экономии -->
        <div class="savings-progress-container" id="savingsProgress" style="display: none;">
            <div class="progress-info">
                <span class="progress-text">До следующего уровня экономии</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar-hero">
                <div class="progress-fill-hero" id="progressFillHero"></div>
            </div>
            <div class="progress-target">
                <span>Цель: <strong id="nextTarget">25,000</strong> сум</span>
            </div>
        </div>
        
        <!-- Эмоциональные бейджи -->
        <div class="hero-badges" id="heroBadges">
            <span class="badge-emotion" id="emotionBadge">🎯</span>
        </div>
    </div>
</div>

<div class="container">
    <!-- Умная навигация -->
    <div class="smart-navigation">
        <div class="breadcrumb-friendly">
            <a href="{% url 'home' %}">
                <i class="fas fa-home"></i>
                Главная
            </a>
            <span class="separator">→</span>
            <span>Корзина</span>
        </div>
    </div>
    
    <!-- Быстрые действия -->
    <div class="quick-actions">
        <a href="{% url 'catalog:catalog' %}" class="quick-action-btn">
            <i class="fas fa-store"></i>
            Каталог
        </a>
        <a href="{% url 'booking:checkout' %}" class="quick-action-btn primary" id="checkoutBtn" style="display: none;">
            <i class="fas fa-credit-card"></i>
            Оформить заказ
        </a>
        <a href="{% url 'booking:order_list' %}" class="quick-action-btn">
            <i class="fas fa-list"></i>
            Мои заказы
        </a>
    </div>
    
    <!-- Умные подсказки -->
         <div class="smart-tips" id="smartTips" style="display: none;">
         <div class="smart-tips-content">
             <div class="smart-tips-icon">💡</div>
             <div class="smart-tips-text" id="tipText">
                 Добавьте еще товаров и получите бесплатную доставку!
             </div>
         </div>
     </div>
    
    <div class="row">
        <div class="col-lg-8">
            <!-- Контейнер товаров корзины -->
            <div id="cartItems">
                <!-- Состояние пустой корзины -->
                <div class="empty-cart-friendly" id="emptyCart">
                    <div class="empty-cart-icon">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                                         <h3>Корзина пуста</h3>
                     <p>Давайте найдем выгодные предложения! 🎯</p>
                    <div class="empty-cart-actions">
                        <a href="{% url 'catalog:catalog' %}" class="quick-action-btn primary">
                            <i class="fas fa-arrow-left"></i>
                            Перейти к покупкам
                        </a>
                    </div>
                </div>
                
                <!-- Загрузка -->
                <div id="loadingSkeleton" style="display: none;">
                    <div class="skeleton-friendly skeleton-item-friendly"></div>
                    <div class="skeleton-friendly skeleton-item-friendly"></div>
                    <div class="skeleton-friendly skeleton-item-friendly"></div>
                </div>
                
                <!-- Список товаров -->
                <div id="cartItemsList" style="display: none;">
                    <!-- Товары будут добавлены через JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Умная сводка заказа -->
            <div class="smart-summary">
                <div class="summary-mood">
                    <span class="mood-icon" id="moodIcon">🎉</span>
                    <span class="mood-text" id="moodText">Отличный выбор!</span>
                </div>
                
                                 <div class="summary-row">
                     <span class="summary-label">Товары:</span>
                     <span class="summary-value" id="subtotal">0 сум</span>
                 </div>
                 
                 <div class="summary-row">
                     <span class="summary-label">Доставка:</span>
                     <span class="summary-value" id="deliveryFee">0 сум</span>
                 </div>
                
                                 <div class="summary-row">
                     <span class="summary-label">Ваша экономия:</span>
                     <span class="summary-value">
                         <span id="savings">0 сум</span>
                         <span class="summary-savings" id="savingsPercent">0%</span>
                     </span>
                 </div>
                
                                 <div class="summary-row">
                     <span class="summary-label">Итого к оплате:</span>
                     <span class="summary-value summary-total" id="total">0 сум</span>
                 </div>
                
                <button class="checkout-btn-friendly" id="checkoutBtnSummary" style="display: none;">
                    <i class="fas fa-credit-card"></i>
                    Оформить заказ
                </button>
                
                <a href="{% url 'catalog:catalog' %}" class="continue-shopping-btn-friendly">
                    <i class="fas fa-plus"></i>
                    Добавить товары
                </a>
            </div>
        </div>
    </div>
</div>

<!-- ===== КАТАЛОГ РЕКОМЕНДУЕМЫХ ТОВАРОВ ===== -->
<section class="recommendations-section">
    <!-- Заголовок секции -->
    <div class="recommendations-header">
        <h3>Рекомендуем к вашему заказу</h3>
        <p>Добавьте и получите дополнительную скидку</p>
    </div>
    
    <!-- Горизонтальный слайдер товаров -->
    <div class="recommendations-carousel-container">
        <button class="carousel-nav-btn carousel-prev" id="carouselPrev">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <div class="recommendations-carousel" id="recommendationsCarousel">
            <!-- Товары будут добавлены через JavaScript -->
        </div>
        
        <button class="carousel-nav-btn carousel-next" id="carouselNext">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>
    
    <!-- Прогресс бесплатной доставки -->
    <div class="delivery-progress" id="deliveryProgress" style="display: none;">
        <div class="progress-info">
            <span class="progress-text">Добавьте еще на <span id="remainingAmount">0</span> сум для бесплатной доставки</span>
            <span class="progress-percentage" id="progressPercentage">0%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
</section>

<!-- Шаблон товара корзины -->
<template id="cartItemTemplate">
    <div class="cart-item-friendly">
        <div class="cart-item-content">
            <img src="" alt="" class="cart-item-image item-image">
            
            <div class="cart-item-details">
                <div class="cart-item-title item-title"></div>
                <div class="cart-item-vendor item-vendor">
                    <i class="fas fa-store"></i>
                    <span></span>
                </div>
                <div class="cart-item-price item-price">
                    <span class="price-amount"></span>
                    <span class="price-savings" style="display: none;"></span>
                </div>
            </div>
            
            <div class="quantity-controls-friendly">
                <button class="quantity-btn-friendly quantity-minus" type="button">
                    <i class="fas fa-minus"></i>
                </button>
                <input type="number" class="quantity-input-friendly" value="1" min="1">
                <button class="quantity-btn-friendly quantity-plus" type="button">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <button class="remove-btn-friendly remove-item">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>
</template>

<!-- Шаблон рекомендуемого товара -->
<template id="recommendationItemTemplate">
    <div class="recommendation-item">
        <div class="recommendation-badges">
            <span class="badge-hot">🔥 Горячее</span>
            <span class="badge-discount">💰 -30%</span>
        </div>
        
        <img src="" alt="" class="recommendation-image">
        
        <div class="recommendation-content">
            <h4 class="recommendation-title"></h4>
            <p class="recommendation-vendor"></p>
            
            <div class="recommendation-price">
                <span class="current-price"></span>
                <span class="original-price"></span>
            </div>
            
            <div class="recommendation-actions">
                <button class="add-to-cart-btn">
                    <i class="fas fa-plus"></i>
                    Добавить
                </button>
                <button class="quick-view-btn">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
        </div>
    </div>
</template>

<!-- Контейнер уведомлений -->
<div id="notificationContainer"></div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/main.js' %}"></script>
<script>
// ===== FRIENDLY SMART CART MANAGEMENT =====
class FriendlySmartCart {
    constructor() {
        this.cart = [];
        this.recommendations = [];
        this.init();
    }
    
    init() {
        this.loadCartItems();
        this.loadRecommendations();
        this.setupEventListeners();
        this.setupStorageListener();
        this.initializeHeroElements();
    }
    
    setupEventListeners() {
        // Обновление корзины при изменении хранилища
        window.addEventListener('storage', (e) => {
            if (e.key === 'foodsave_cart') {
                this.loadCartItems();
            }
        });
        
        // Навигация по карусели
        this.setupCarouselNavigation();
    }
    
    setupStorageListener() {
        // Прослушивание пользовательских событий хранилища
        window.addEventListener('cartUpdated', () => {
            this.loadCartItems();
        });
    }
    
    initializeHeroElements() {
        // Инициализация прогресс-бара и эмоциональных элементов
        this.updateSavingsProgress(0);
        this.updateEmotionalBadge(0);
        
        // Добавляем анимацию появления для статистики
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 200);
        });
    }
    
    loadCartItems() {
        this.showLoading();
        
        // Симуляция задержки загрузки для лучшего UX
        setTimeout(() => {
            this.cart = JSON.parse(localStorage.getItem('foodsave_cart')) || [];
            this.renderCart();
            this.hideLoading();
        }, 300);
    }
    
    showLoading() {
        document.getElementById('loadingSkeleton').style.display = 'block';
        document.getElementById('cartItemsList').style.display = 'none';
        document.getElementById('emptyCart').style.display = 'none';
    }
    
    hideLoading() {
        document.getElementById('loadingSkeleton').style.display = 'none';
    }
    
    renderCart() {
        const cartItemsList = document.getElementById('cartItemsList');
        const emptyCart = document.getElementById('emptyCart');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const checkoutBtnSummary = document.getElementById('checkoutBtnSummary');
        const smartTips = document.getElementById('smartTips');
        
        if (this.cart.length === 0) {
            cartItemsList.style.display = 'none';
            emptyCart.style.display = 'block';
            checkoutBtn.style.display = 'none';
            checkoutBtnSummary.style.display = 'none';
            smartTips.style.display = 'none';
            this.updateOrderSummary(0, 0);
            this.updateMood('empty');
            return;
        }
        
        cartItemsList.style.display = 'block';
        emptyCart.style.display = 'none';
        checkoutBtn.style.display = 'inline-flex';
        checkoutBtnSummary.style.display = 'block';
        
        cartItemsList.innerHTML = '';
        let subtotal = 0;
        
        this.cart.forEach((item, index) => {
            const cartItem = this.createCartItemElement(item, index);
            cartItemsList.appendChild(cartItem);
            
                         // Мок-расчет цены (заменить на реальные данные)
             const price = 15990;
             subtotal += price * item.quantity;
        });
        
        this.updateOrderSummary(subtotal, this.cart.length);
        this.updateItemCount();
        this.updateMood(this.cart.length);
        this.updateSavingsProgress(subtotal);
        this.updateEmotionalBadge(subtotal);
        this.updateSmartTips(subtotal);
        this.updateDeliveryProgress(subtotal);
    }
    
    createCartItemElement(item, index) {
        const template = document.getElementById('cartItemTemplate');
        const cartItem = template.content.cloneNode(true);
        
                 // Мок-данные - в реальном приложении это будет приходить из API
         const mockData = {
             title: 'Пицца Маргарита',
             vendor: 'Пиццерия "Вкусно"',
             price: 15990,
             originalPrice: 19990,
             image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=200'
         };
        
        // Установка данных товара
        cartItem.querySelector('.item-image').src = mockData.image;
        cartItem.querySelector('.item-image').alt = mockData.title;
        cartItem.querySelector('.item-title').textContent = mockData.title;
        cartItem.querySelector('.item-vendor span').textContent = mockData.vendor;
                 cartItem.querySelector('.price-amount').textContent = `${mockData.price.toLocaleString()} сум`;
        
        // Показ экономии если есть
        if (mockData.originalPrice > mockData.price) {
            const savings = mockData.originalPrice - mockData.price;
            const savingsPercent = Math.round((savings / mockData.originalPrice) * 100);
            cartItem.querySelector('.price-savings').textContent = `Экономия ${savingsPercent}%`;
            cartItem.querySelector('.price-savings').style.display = 'inline';
        }
        
        cartItem.querySelector('.quantity-input-friendly').value = item.quantity;
        
        // Добавление обработчиков событий с улучшенным UX
        this.addItemEventListeners(cartItem, index);
        
        return cartItem;
    }
    
    addItemEventListeners(cartItem, index) {
        const quantityInput = cartItem.querySelector('.quantity-input-friendly');
        const minusBtn = cartItem.querySelector('.quantity-minus');
        const plusBtn = cartItem.querySelector('.quantity-plus');
        const removeBtn = cartItem.querySelector('.remove-item');
        
        // Контроль количества с тактильной обратной связью
        minusBtn.addEventListener('click', () => {
            this.updateQuantity(index, -1);
            this.addHapticFeedback();
        });
        
        plusBtn.addEventListener('click', () => {
            this.updateQuantity(index, 1);
            this.addHapticFeedback();
        });
        
        removeBtn.addEventListener('click', () => {
            this.removeCartItem(index);
            this.addHapticFeedback();
        });
        
        quantityInput.addEventListener('change', (e) => {
            const newQuantity = parseInt(e.target.value) || 1;
            this.updateCartItemQuantity(index, newQuantity);
        });
        
        // Добавление плавных анимаций
        cartItem.querySelector('.cart-item-friendly').style.animationDelay = `${index * 0.1}s`;
    }
    
    updateQuantity(index, change) {
        if (this.cart[index]) {
            this.cart[index].quantity = Math.max(1, this.cart[index].quantity + change);
            this.saveCart();
            this.loadCartItems();
            this.updateCartCounter();
            this.showNotification('Количество обновлено! 💰', 'success');
        }
    }
    
    updateCartItemQuantity(index, quantity) {
        if (this.cart[index]) {
            this.cart[index].quantity = Math.max(1, quantity);
            this.saveCart();
            this.loadCartItems();
            this.updateCartCounter();
            this.showNotification('Количество обновлено! 💰', 'success');
        }
    }
    
    removeCartItem(index) {
        this.cart.splice(index, 1);
        this.saveCart();
        this.loadCartItems();
        this.updateCartCounter();
        this.showNotification('Товар удален из корзины 💰', 'info');
    }
    
    saveCart() {
        localStorage.setItem('foodsave_cart', JSON.stringify(this.cart));
        // Отправка пользовательского события для других компонентов
        window.dispatchEvent(new CustomEvent('cartUpdated'));
    }
    
         updateOrderSummary(subtotal, itemCount) {
         const deliveryFee = itemCount > 0 ? (subtotal > 20000 ? 0 : 5000) : 0;
         const savings = Math.round(subtotal * 0.15); // 15% экономия
         const total = subtotal + deliveryFee - savings;
         
         document.getElementById('subtotal').textContent = `${subtotal.toLocaleString()} сум`;
         document.getElementById('deliveryFee').textContent = `${deliveryFee.toLocaleString()} сум`;
         document.getElementById('savings').textContent = `${savings.toLocaleString()} сум`;
         document.getElementById('savingsPercent').textContent = '15%';
         document.getElementById('total').textContent = `${total.toLocaleString()} сум`;
     }
    
    updateItemCount() {
        const itemCount = this.cart.reduce((total, item) => total + item.quantity, 0);
        document.getElementById('itemCount').textContent = itemCount;
    }
    
    updateMood(itemCount) {
        const moodElement = document.getElementById('heroSubtitle');
        if (!moodElement) return;
        
        let mood = 'Готовы к выгодной покупке? 💰';
        
        if (itemCount === 0) {
            mood = 'Ваша корзина пуста 😔';
        } else if (itemCount <= 3) {
            mood = 'Отличное начало! 🚀';
        } else if (itemCount <= 6) {
            mood = 'Хороший выбор! 👍';
        } else if (itemCount <= 10) {
            mood = 'Отличная корзина! 🎉';
        } else {
            mood = 'Вы - VIP клиент! 🏆';
        }
        
        moodElement.textContent = mood;
    }
    
    updateSavingsProgress(total) {
        const progressContainer = document.getElementById('savingsProgress');
        const progressFill = document.getElementById('progressFillHero');
        const progressPercent = document.getElementById('progressPercent');
        const nextTarget = document.getElementById('nextTarget');
        const totalSavings = document.getElementById('totalSavings');
        
        if (!progressContainer || !progressFill || !progressPercent || !nextTarget || !totalSavings) return;
        
        // Показываем прогресс-бар только если есть товары
        if (total > 0) {
            progressContainer.style.display = 'block';
            
            // Рассчитываем экономию (пример: 15% от общей суммы)
            const savings = Math.round(total * 0.15);
            totalSavings.textContent = savings.toLocaleString();
            
            // Определяем следующий порог для скидки
            let nextThreshold = 25000;
            let currentProgress = 0;
            
            if (total >= 50000) {
                nextThreshold = 100000;
                currentProgress = Math.min((total - 50000) / 50000 * 100, 100);
            } else if (total >= 25000) {
                nextThreshold = 50000;
                currentProgress = Math.min((total - 25000) / 25000 * 100, 100);
            } else {
                currentProgress = Math.min(total / 25000 * 100, 100);
            }
            
            nextTarget.textContent = nextThreshold.toLocaleString();
            progressPercent.textContent = Math.round(currentProgress) + '%';
            progressFill.style.width = currentProgress + '%';
        } else {
            progressContainer.style.display = 'none';
        }
    }
    
    updateEmotionalBadge(total) {
        const emotionBadge = document.getElementById('emotionBadge');
        if (!emotionBadge) return;
        
        let emoji = '🎯';
        
        if (total === 0) {
            emoji = '🛒';
        } else if (total < 15000) {
            emoji = '💰';
        } else if (total < 30000) {
            emoji = '🔥';
        } else if (total < 50000) {
            emoji = '⚡';
        } else if (total < 100000) {
            emoji = '🏆';
        } else {
            emoji = '👑';
        }
        
        emotionBadge.textContent = emoji;
        
        // Добавляем анимацию при смене эмодзи
        emotionBadge.style.animation = 'none';
        emotionBadge.offsetHeight; // Trigger reflow
        emotionBadge.style.animation = 'emotionFloat 3s ease-in-out infinite';
    }
    
    updateSmartTips(subtotal) {
        const smartTips = document.getElementById('smartTips');
        const tipText = document.getElementById('tipText');
        
                 if (subtotal < 10000) {
             smartTips.style.display = 'block';
             tipText.textContent = 'Добавьте еще товаров на 10,000 сум и получите бесплатную доставку! 🚚';
         } else if (subtotal < 20000) {
             smartTips.style.display = 'block';
             tipText.textContent = 'Добавьте товаров на 20,000 сум и получите скидку 20%! 💰';
         } else {
             smartTips.style.display = 'none';
         }
    }
    
    updateCartCounter() {
        // Обновление счетчика корзины в заголовке если существует
        const cartCounter = document.querySelector('.cart-counter');
        if (cartCounter) {
            const totalItems = this.cart.reduce((total, item) => total + item.quantity, 0);
            cartCounter.textContent = totalItems;
        }
    }
    
    showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification-friendly ${type}`;
        
        const icon = this.getNotificationIcon(type);
        notification.innerHTML = `
            <div class="notification-icon">${icon}</div>
            <div class="notification-text">${message}</div>
        `;
        
        document.getElementById('notificationContainer').appendChild(notification);
        
        // Автоматическое удаление через 3 секунды
        setTimeout(() => {
            notification.style.animation = 'slideInRight 0.3s ease-out reverse';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
    
         getNotificationIcon(type) {
         const icons = {
             success: '✅',
             error: '⚠️',
             info: '💡'
         };
         return icons[type] || '💡';
     }
    
    addHapticFeedback() {
        // Добавление тактильной обратной связи если поддерживается
        if (navigator.vibrate) {
            navigator.vibrate(50);
        }
    }
    
    // ===== РЕКОМЕНДУЕМЫЕ ТОВАРЫ =====
    loadRecommendations() {
        // Мок-данные рекомендаций (в реальном приложении это будет API)
        this.recommendations = [
            {
                id: 1,
                title: 'Кока-Кола',
                vendor: 'Пиццерия "Вкусно"',
                price: 3000,
                originalPrice: 4500,
                image: 'https://images.unsplash.com/photo-1629203851122-3726ecdf080e?w=200',
                discount: 33,
                badge: 'hot'
            },
            {
                id: 2,
                title: 'Тирамису',
                vendor: 'Кафе "Сладкоежка"',
                price: 8000,
                originalPrice: 12000,
                image: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=200',
                discount: 33,
                badge: 'discount'
            },
            {
                id: 3,
                title: 'Чизкейк',
                vendor: 'Кондитерская "Радость"',
                price: 6500,
                originalPrice: 9000,
                image: 'https://images.unsplash.com/photo-1533134242443-d4fd215305ad?w=200',
                discount: 28,
                badge: 'new'
            },
            {
                id: 4,
                title: 'Мохито',
                vendor: 'Бар "Тропики"',
                price: 5500,
                originalPrice: 7500,
                image: 'https://images.unsplash.com/photo-1579952363873-27f3bade9f55?w=200',
                discount: 27,
                badge: 'hot'
            },
            {
                id: 5,
                title: 'Салат Цезарь',
                vendor: 'Ресторан "Италия"',
                price: 12000,
                originalPrice: 15000,
                image: 'https://images.unsplash.com/photo-1546793665-c74683f339c1?w=200',
                discount: 20,
                badge: 'popular'
            }
        ];
        
        this.renderRecommendations();
    }
    
    renderRecommendations() {
        const carousel = document.getElementById('recommendationsCarousel');
        if (!carousel) return;
        
        carousel.innerHTML = '';
        
        this.recommendations.forEach(item => {
            const recommendationItem = this.createRecommendationElement(item);
            carousel.appendChild(recommendationItem);
        });
    }
    
    createRecommendationElement(item) {
        const template = document.getElementById('recommendationItemTemplate');
        const recommendationItem = template.content.cloneNode(true);
        
        // Установка данных
        recommendationItem.querySelector('.recommendation-image').src = item.image;
        recommendationItem.querySelector('.recommendation-image').alt = item.title;
        recommendationItem.querySelector('.recommendation-title').textContent = item.title;
        recommendationItem.querySelector('.recommendation-vendor').textContent = item.vendor;
        recommendationItem.querySelector('.current-price').textContent = `${item.price.toLocaleString()} сум`;
        recommendationItem.querySelector('.original-price').textContent = `${item.originalPrice.toLocaleString()} сум`;
        
        // Обновление бейджей
        const badges = recommendationItem.querySelector('.recommendation-badges');
        badges.innerHTML = '';
        
        if (item.badge === 'hot') {
            badges.innerHTML = '<span class="badge-hot">🔥 Горячее</span>';
        } else if (item.badge === 'discount') {
            badges.innerHTML = `<span class="badge-discount">💰 -${item.discount}%</span>`;
        } else if (item.badge === 'new') {
            badges.innerHTML = '<span class="badge-hot">🆕 Новинка</span>';
        } else if (item.badge === 'popular') {
            badges.innerHTML = '<span class="badge-discount">⭐ Популярное</span>';
        }
        
        // Добавление обработчиков событий
        const addToCartBtn = recommendationItem.querySelector('.add-to-cart-btn');
        const quickViewBtn = recommendationItem.querySelector('.quick-view-btn');
        
        addToCartBtn.addEventListener('click', () => {
            this.addRecommendationToCart(item);
        });
        
        quickViewBtn.addEventListener('click', () => {
            this.quickViewItem(item);
        });
        
        return recommendationItem;
    }
    
    addRecommendationToCart(item) {
        // Проверяем, есть ли уже такой товар в корзине
        const existingItem = this.cart.find(cartItem => cartItem.id === item.id);
        
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            this.cart.push({
                id: item.id,
                quantity: 1
            });
        }
        
        this.saveCart();
        this.loadCartItems();
        this.showNotification(`"${item.title}" добавлен в корзину! 💰`, 'success');
        this.addHapticFeedback();
    }
    
    quickViewItem(item) {
        // Быстрый просмотр товара (можно открыть модальное окно)
        this.showNotification(`Быстрый просмотр: ${item.title}`, 'info');
    }
    
    updateDeliveryProgress(subtotal) {
        const deliveryProgress = document.getElementById('deliveryProgress');
        const remainingAmount = document.getElementById('remainingAmount');
        const progressPercentage = document.getElementById('progressPercentage');
        const progressFill = document.getElementById('progressFill');
        
        const freeDeliveryThreshold = 20000; // 20,000 сум для бесплатной доставки
        const remaining = Math.max(0, freeDeliveryThreshold - subtotal);
        const percentage = Math.min(100, (subtotal / freeDeliveryThreshold) * 100);
        
        if (subtotal > 0 && subtotal < freeDeliveryThreshold) {
            deliveryProgress.style.display = 'block';
            remainingAmount.textContent = remaining.toLocaleString();
            progressPercentage.textContent = `${Math.round(percentage)}%`;
            progressFill.style.width = `${percentage}%`;
        } else {
            deliveryProgress.style.display = 'none';
        }
    }
    
    // ===== НАВИГАЦИЯ ПО КАРУСЕЛИ =====
    setupCarouselNavigation() {
        const carousel = document.getElementById('recommendationsCarousel');
        const prevBtn = document.getElementById('carouselPrev');
        const nextBtn = document.getElementById('carouselNext');
        
        if (!carousel || !prevBtn || !nextBtn) return;
        
        // Плавная прокрутка влево
        prevBtn.addEventListener('click', () => {
            this.smoothScrollTo(carousel, -300);
        });
        
        // Плавная прокрутка вправо
        nextBtn.addEventListener('click', () => {
            this.smoothScrollTo(carousel, 300);
        });
        
        // Touch/swipe поддержка для мобильных с премиальной анимацией
        let startX = 0;
        let scrollLeft = 0;
        let isScrolling = false;
        
        carousel.addEventListener('touchstart', (e) => {
            startX = e.touches[0].pageX - carousel.offsetLeft;
            scrollLeft = carousel.scrollLeft;
            isScrolling = false;
        });
        
        carousel.addEventListener('touchmove', (e) => {
            if (!startX) return;
            
            const x = e.touches[0].pageX - carousel.offsetLeft;
            const walk = (x - startX) * 1.5; // Более чувствительный свайп
            
            if (Math.abs(walk) > 10) {
                isScrolling = true;
                carousel.scrollLeft = scrollLeft - walk;
            }
        });
        
        carousel.addEventListener('touchend', (e) => {
            if (!isScrolling) return;
            
            const endX = e.changedTouches[0].pageX - carousel.offsetLeft;
            const walk = (endX - startX) * 1.5;
            
            // Если свайп был достаточно сильным, прокручиваем к следующей карточке
            if (Math.abs(walk) > 100) {
                const direction = walk > 0 ? -1 : 1;
                const scrollDistance = 280 + 16; // ширина карточки + gap
                this.smoothScrollTo(carousel, direction * scrollDistance);
            }
            
            startX = 0;
            isScrolling = false;
        });
        
        // Обновление состояния кнопок при скролле
        carousel.addEventListener('scroll', () => {
            this.updateCarouselButtons();
        });
        
        // Инициализация состояния кнопок
        this.updateCarouselButtons();
    }
    
    updateCarouselButtons() {
        const carousel = document.getElementById('recommendationsCarousel');
        const prevBtn = document.getElementById('carouselPrev');
        const nextBtn = document.getElementById('carouselNext');
        
        if (!carousel || !prevBtn || !nextBtn) return;
        
        const isAtStart = carousel.scrollLeft <= 0;
        const isAtEnd = carousel.scrollLeft >= carousel.scrollWidth - carousel.clientWidth;
        
        prevBtn.style.opacity = isAtStart ? '0.5' : '1';
        prevBtn.style.pointerEvents = isAtStart ? 'none' : 'auto';
        
        nextBtn.style.opacity = isAtEnd ? '0.5' : '1';
        nextBtn.style.pointerEvents = isAtEnd ? 'none' : 'auto';
    }
    
    // ===== ПРЕМИАЛЬНАЯ ПЛАВНАЯ АНИМАЦИЯ =====
    smoothScrollTo(carousel, distance) {
        const startPosition = carousel.scrollLeft;
        const targetPosition = startPosition + distance;
        const startTime = performance.now();
        const duration = 800; // 800ms для премиального ощущения
        
        const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3); // Плавная кривая замедления
        
        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const easedProgress = easeOutCubic(progress);
            
            carousel.scrollLeft = startPosition + (distance * easedProgress);
            
            if (progress < 1) {
                requestAnimationFrame(animate);
            }
        };
        
        requestAnimationFrame(animate);
    }
}

// Инициализация дружелюбной умной корзины при загрузке DOM
document.addEventListener('DOMContentLoaded', function() {
    new FriendlySmartCart();
});
</script>
{% endblock %}
